<div class="h-full user-select-none">
  <div cdkDropList (cdkDropListDropped)="dropFile($event)" class="basic-font file-list">
    @for (fileGroup of store.rearrangeFilesSignal(); track fileGroup; let index = $index) {
      <div class="flex file-item">

        <div class="side-col-width mr-3">
          @if(fileGroup.isSelected
              && store.rearrangeFilesSignal()[index+1].isSelected
              && !store.rearrangeFilesSignal()[index-1].isSelected
            ) {
            <button mat-mini-fab (click)="groupFiles(index)">
              <i class="material-icons font-size-medium">lock</i>
            </button>
          }
          @if(fileGroup.files.length > 1 && !fileGroup.isSelected) {
            <button (click)="ungroupFiles(index)">
              <i class="material-icons font-size-medium">lock_open</i>
            </button>
          }
        </div>

        <div
          cdkDrag
          [ngClass]="{
            'highlight-blue-bg-color-gradient': fileGroup.isSelected,
            'header-bg-color': !fileGroup.isSelected,
          }"
          class="file-entry flex items-center w-full"
        >
          <div
            class="file-custom-placeholder router-bg-color material-box-shadow-inset"
            *cdkDragPlaceholder
          ></div>
          <div class="flex items-center w-full h-full">
            <div
              class="flex justify-end index-column pl-2 pr-3"
            >
              {{ index + 1 }}.
            </div>
            <div
              class="flex cursor-grab h-full justify-center items-center pr-3"
            >
              <i cdkDragHandle class="material-icons font-size-medium">drag_indicator</i>
            </div>
            <div
              (mousedown)="onMouseDown($event, fileGroup)"
              (mouseenter)="onMouseEnterFile(fileGroup)"
              (click)="onFileClick($event, fileGroup, index)"
              class="flex items-center w-full h-full"
            >
              <div>
                @for(file of fileGroup.files; track file; let subindex = $index) {
                  <div class="long-word-break" [innerHTML]="file.displayName"></div>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
